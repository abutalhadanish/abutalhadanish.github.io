<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiplication Table Quiz</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to top right, #fbc2eb, #a6c1ee);
      /* background: url('https://images.unsplash.com/photo-1595526114035-6b61f65df2c8?fit=crop&w=1500&q=80') no-repeat center center fixed;
      background-size: cover; */
      padding: 30px;
      color: #333;
      text-align: center;
    }
    h1 {
      font-family: 'Fredoka One', cursive;
      font-size: 3em;
      color: #ff6f61;
      margin-bottom: 20px;
    }
    input, button, select {
      font-size: 1.2em;
      padding: 12px 16px;
      margin: 10px;
      border-radius: 12px;
      border: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    input[type="text"] {
      width: 300px;
    }
    button {
      background-color: #ffd166;
      color: #333;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    button:hover {
      background-color: #fcbf49;
      transform: scale(1.05);
    }
    #quiz-box, #summary, #settings-box {
      display: none;
      margin: 30px auto;
      background: #ffffff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      max-width: 600px;
    }
    .question {
      font-size: 2.5em;
      color: #118ab2;
      margin-bottom: 20px;
    }
    .progress {
      font-size: 1.2em;
      color: #666;
      margin-bottom: 10px;
    }
    .progress-bar-container {
      width: 100%;
      background-color: #eee;
      height: 8px;
      border-radius: 5px;
      margin: 10px 0 20px;
    }
    .progress-bar {
      height: 8px;
      background-color: #06d6a0;
      border-radius: 5px;
      transition: width 0.3s ease;
      width: 0;
    }
    .options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      justify-items: center;
    }
    .options button {
      background: #06d6a0;
      background: #ff9c17;
      color: white;
      border: none;
      font-size: 1.3em;
      border-radius: 16px;
      padding: 15px 30px;
      cursor: pointer;
      width: 100%;
    }
    .options button:hover {
      background: #04b383;
      background: #ffc600;
    }
    .correct {
      background-color: #408f50 !important;
    }
    .wrong {
      /* background-color: #f08080 !important; */
    }
    .settings-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 2em;
    }
    #timer {
      font-size: 1.3em;
      margin-top: 10px;
      color: #073b4c;
    }
    label {
      font-size: 1em;
      display: block;
      margin-top: 10px;
    }
    #summary h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 2.2em;
      color: #073b4c;
    }
    #summary p {
      font-size: 1.3em;
    }
    #summary ul {
      list-style: none;
      padding: 0;
    }
    #summary li {
      background: #ffe066;
      margin: 10px 0;
      padding: 10px;
      border-radius: 12px;
    }
    #kidNameDisplay {
      color: #ff6f61;
      font-family: 'Fredoka One', cursive;
      font-size: 1.2em;
      text-shadow: 1px 1px #fff;
    }
    /* @keyframes sparkle {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    #kidNameDisplay {
      color: #ff6f61;
      font-family: 'Fredoka One', cursive;
      font-size: 1.4em;
      text-shadow: 2px 2px #fff;
      display: inline-block;
      animation: sparkle 1.5s ease-in-out infinite;
    } */


    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      input[type="text"], input[type="number"], select, button {
        font-size: 1em;
        padding: 10px 14px;
        width: 90%;
      }
      #quiz-box, #summary, #settings-box {
        width: 95%;
        padding: 20px;
      }
      .question {
        font-size: 2em;
      }
      .options {
        /* grid-template-columns: 1fr; */
      }
      .options button {
        font-size: 1.1em;
        padding: 12px 20px;
      }
      .settings-icon {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
    <audio id="sound-correct" src="sounds/correct.mp3" preload="auto"></audio>
    <audio id="sound-wrong" src="sounds/wrong.mp3" preload="auto"></audio>
    <audio id="sound-complete" src="sounds/complete.mp3" preload="auto"></audio>

    <h1 id="title">üß† <span id="kidNameDisplay">Maryam</span>'s Multiplication Table Quiz</h1>
  <div>
    <input id="numbers" type="text" placeholder="Enter one or more numbers e.g. 2,5,7" inputmode="numeric" pattern="[0-9,]*" />
    <button onclick="startQuiz()">Start Quiz</button>
  </div>
  <div class="settings-icon" onclick="toggleSettings()">‚öôÔ∏è</div>
  <div id="settings-box">
    <label>üëß Kid's Name: <input type="text" id="kidName" value="Maryam" /></label>
    <label>‚è± Time per question (T): <input type="number" id="timeLimit" value="10" min="1" /></label>
    <label>#Ô∏è‚É£ Number of questions (N): <input type="number" id="numQuestions" value="20" min="1" /></label>
    <label>üîä Sound Effects:
      <select id="soundSetting">
        <option value="on" selected>On</option>
        <option value="off">Off</option>
      </select>
    </label>
    <label>üå°Ô∏è Exclude Easy Numbers:
      <select id="exclusionSetting">
        <option value="yes" selected>On</option>
        <option value="no">Off</option>
      </select>
    </label>
    <label>üî§ Font Size:
      <select id="fontSizeSetting" onchange="applyFontSize(this.value)">
        <option value="small">Small</option>
        <option value="medium" selected>Medium</option>
        <option value="large">Large</option>
      </select>
    </label>
    <button onclick="toggleSettings()">Close Settings</button>
  </div>

  <div id="quiz-box">
    <div class="progress" id="progress"></div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>
    <div id="timer"></div>
  </div>

  <div id="summary"></div>

  <script>
    let settingsVisible = false;
    let quizData = [];
    let currentIndex = 0;
    let score = 0;
    let timer;
    let timeLeft;
    let soundEnabled = true;
    let exclusionEnabled = true;
    let settings = {
      T: 10,
      N: 20,
      fontSize: 'medium',
      kidName: 'Maryam'
    };
    let defaultNumbers = [2,3,4,5,6,7,8,9,12,13,14,15,16,17,18,19,20];
    let excludedNumbers = [1,10,11,0];

    document.on('load', ()=>{
      alert('hi ');
    });

    function toggleSettings() {
      settingsVisible = !settingsVisible;
      document.getElementById("settings-box").style.display = settingsVisible ? "block" : "none";
    }

    function applyFontSize(fontSize) {
      const root = document.documentElement;
      if (fontSize === 'small') root.style.fontSize = '14px';
      else if (fontSize === 'medium') root.style.fontSize = '18px';
      else if (fontSize === 'large') root.style.fontSize = '22px';
    }

    function playSound(type) {
      if (!soundEnabled) return;
      const soundMap = {
        correct: 'sound-correct',
        wrong: 'sound-wrong',
        complete: 'sound-complete'
      };
      const audio = document.getElementById(soundMap[type]);
      if (audio) audio.play();
    }

    function startQuiz() {
      const numbersInput = document.getElementById("numbers").value;
      // console.log("LEN ", numbersInput.length)
      let numbers = [];
      if (numbersInput.length == 0){
        numbers = [...defaultNumbers];
      }
      else {
        numbers = numbersInput.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)).filter(n => !exclusionEnabled || !excludedNumbers.includes(n));
      }
      if (numbers.length === 0) return alert("Please enter valid numbers.");

      settings.T = parseInt(document.getElementById("timeLimit").value) || 10;
      settings.N = parseInt(document.getElementById("numQuestions").value) || 20;
      settings.fontSize = document.getElementById("fontSizeSetting").value;
      settings.kidName = document.getElementById("kidName").value || "Maryam";
      document.getElementById("kidNameDisplay").textContent = settings.kidName;
      soundEnabled = document.getElementById("soundSetting").value === 'on';
      exclusionEnabled = document.getElementById("exclusionSetting").value === 'yes';

      // document.getElementById("title").textContent = `${settings.kidName}'s Multiplication Table Quiz`;
      applyFontSize(settings.fontSize);
      document.getElementById("settings-box").style.display = "none";
      settingsVisible = false;

      quizData = generateQuestions(numbers, settings.N);
      currentIndex = 0;
      score = 0;
      document.getElementById("summary").style.display = "none";
      document.getElementById("quiz-box").style.display = "block";
      showQuestion();

      saveSettingsToLocalStorage();
    }

    function saveSettingsToLocalStorage() {
      const config = {
        kidName: document.getElementById("kidName").value,
        timeLimit: document.getElementById("timeLimit").value,
        numQuestions: document.getElementById("numQuestions").value,
        soundSetting: document.getElementById("soundSetting").value,
        exclusionSetting: document.getElementById("exclusionSetting").value,
        fontSizeSetting: document.getElementById("fontSizeSetting").value,
        numbers: document.getElementById("numbers").value
      };
      localStorage.setItem("quizSettings", JSON.stringify(config));
    }

    function loadSettingsFromLocalStorage() {
      const config = JSON.parse(localStorage.getItem("quizSettings"));
      if (!config) return;
      document.getElementById("kidName").value = config.kidName || "Maryam";
      document.getElementById("timeLimit").value = config.timeLimit || 10;
      document.getElementById("numQuestions").value = config.numQuestions || 20;
      document.getElementById("soundSetting").value = config.soundSetting || "on";
      document.getElementById("exclusionSetting").value = config.exclusionSetting || "yes";
      document.getElementById("fontSizeSetting").value = config.fontSizeSetting || "medium";
      // document.getElementById("numbers").value = config.numbers || "";
      document.getElementById("kidNameDisplay").textContent = config.kidName || "Maryam";
      applyFontSize(config.fontSizeSetting || "medium");
    }

    document.addEventListener("DOMContentLoaded", loadSettingsFromLocalStorage);

    function generateQuestions(numbers, count) {
      const questions = [];
      while (questions.length < count) {
        const num = numbers[Math.floor(Math.random() * numbers.length)];
        const multiplier = Math.floor(Math.random() * 9) + 2;
        const correctAnswer = num * multiplier;
        const options = new Set([correctAnswer]);
        while (options.size < 4) {
          let fakeAnswer = correctAnswer + Math.floor(Math.random() * 11) - 5;
          if (fakeAnswer > 0 && fakeAnswer !== correctAnswer) options.add(fakeAnswer);
        }
        questions.push({ question: `${num} √ó ${multiplier}`, correct: correctAnswer, options: shuffle(Array.from(options)) });
      }
      return questions;
    }

    function showQuestion() {
      clearTimeout(timer);
      timeLeft = settings.T;

      const progressPercent = ((currentIndex) / settings.N) * 100;
      document.getElementById("progress").textContent = `Question ${currentIndex + 1} / ${settings.N}`;
      document.getElementById("progress-bar").style.width = `${progressPercent}%`;

      const q = quizData[currentIndex];
      document.getElementById("question").textContent = q.question;
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => answerQuestion(opt);
        optionsDiv.appendChild(btn);
      });

      updateTimer();
    }

    function updateTimer() {
      document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;
      if (timeLeft <= 0) return answerQuestion(null);
      timeLeft--;
      timer = setTimeout(updateTimer, 1000);
    }

    function answerQuestion(selected) {
      clearTimeout(timer);
      const q = quizData[currentIndex];
      const buttons = document.querySelectorAll("#options button");
      buttons.forEach(btn => {
        if (parseInt(btn.textContent) === q.correct) btn.classList.add("correct");
        else if (parseInt(btn.textContent) === selected) btn.classList.add("wrong");
        btn.disabled = true;
      });

      if (selected === q.correct) {
        score++;
        q.result = "correct";
        playSound('correct');
      } else {
        q.result = "wrong";
        playSound('wrong');
      }

      setTimeout(() => {
        currentIndex++;
        if (currentIndex < quizData.length) showQuestion();
        else showSummary();
      }, 1000);
    }

    function showSummary() {
      playSound('complete');
      document.getElementById("quiz-box").style.display = "none";
      const summary = document.getElementById("summary");

      let message = "Well Done!";
      const percent = (score / settings.N) * 100;
      if (percent === 100) message = "üåü üåü üåü <br/> Perfect Score! You're a WINNER!";
      else if (percent >= 80) message = "üéâ Excellent! You're doing great!";
      else if (percent >= 60) message = "üëç Good try! Keep practicing!";
      else if (percent >= 40) message = "Keep practicing, you may do better!";
      else message = "üòî That was disappointing! \n Keep learning and improving!";

      summary.innerHTML = `<h2>${message}</h2><p>Your Score: <strong>${score} / ${settings.N}</strong></p>`;

      const wrongAnswers = quizData.filter(q => q.result === "wrong");
      if (wrongAnswers.length > 0) {
        const list = document.createElement("ul");
        wrongAnswers.forEach(q => {
          const item = document.createElement("li");
          item.textContent = `${q.question} = ${q.correct}`;
          list.appendChild(item);
        });
        const header = document.createElement("h3");
        header.textContent = "üìù Review these questions:";
        summary.appendChild(header);
        summary.appendChild(list);
      }

      summary.style.display = "block";
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
  </script>
</body>
</html>